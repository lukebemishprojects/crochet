plugins {
    id 'java'
    id 'maven-publish'
    id 'dev.lukebemish.crochet'
}

java.withSourcesJar()

group = 'dev.lukebemish.crochet.crochet-test'
version = '1.0.0'

repositories {
    mavenCentral()
    maven {
        url = 'https://maven.fabricmc.net/'
    }
}

crochet {
    def ms = mappings('official', 'intermediary') {

    }
    remap(configurations.runtimeClasspath, ms)
    remap(configurations.compileClasspath, ms)

    remapOutgoing('', ms)

    useTinyRemapper()
}

dependencies {
    crochetMappingsOfficialToIntermediary 'net.fabricmc:intermediary:1.20.4'

    implementation 'dev.lukebemish.autoextension:autoextension:0.1.1'
    implementation project(':subproject')
}

jar {
    manifest {
        attributes(
            'Main-Class': 'dev.lukebemish.crochet.CrochetTest'
        )
    }
}

allprojects {
    apply plugin: 'java'
    apply plugin: 'maven-publish'

    version = rootProject.version
    group = rootProject.group

    publishing {
        publications {
            mavenJava(MavenPublication) {
                from components.java
            }
        }

        repositories {
            maven {
                name 'repo'
                url rootProject.file('build/repo')
            }
        }
    }

    tasks.register("resolveRuntimeClasspath", Copy) {
        from(configurations.runtimeClasspath)
        into(layout.buildDirectory.dir("runtimeClasspath"))
    }
}
